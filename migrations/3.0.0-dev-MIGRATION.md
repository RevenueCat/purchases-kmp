# 3.0.0-dev Migration Guide
Version 3.0.0 is in developer preview and ready for early feedback!  

> [!WARNING]
> `3.0.0-dev` versions are **not** ready for production use. As of now there is **zero guarantee** that purchases-kmp will be going in this direction.

This version is based on the public preview of Kotlin's upcoming SwiftPM import feature, which is currently being developed by JetBrains. Please try it out and [report any issues](https://github.com/RevenueCat/purchases-kmp/issues/new/) you find. Make sure to state clearly that you're using version 3.0.0. Thanks!

## Remove the native iOS SDK
Coming from a version before `3.0.0-dev01`, your iOS project will have a dependency on RevenueCat's `PurchasesHybridCommon` native iOS dependency. This should be removed. The instructions depend on how you added it.

### Remove from Swift Package Manager
If you've added `PurchasesHybridCommon` to your iOS project using Swift Package Manager, do the following:
1. Open Xcode and select your project in the Project navigator.
2. Click Package Dependencies.
3. Select the `PurchasesHybridCommon` dependency and click the '-' (minus) button to remove it.

### Remove from CocoaPods
If you've added `PurchasesHybridCommon` to your iOS project using CocoaPods, there are 2 possible places where the `PurchasesHybridCommon` dependency could be defined. Make sure it is removed from both.

Your `Podfile` might contain a line as follows. Remove this line:
```ruby
pod 'PurchasesHybridCommon', '17.21.2'
```

Your `build.gradle[.kts]` might contain a section as follows. Remove this section:
```kotlin
pod("PurchasesHybridCommon") {  
    version = "17.21.2"
    extraOpts += listOf("-compiler-option", "-fmodules")  
} 
```

## Enable SwiftPM import
> [!NOTE]
> This is subject to change as JetBrains develops the SwiftPM import feature in Kotlin.

This version of purchases-kmp is based on the public preview of Kotlin's upcoming SwiftPM import feature, currently being developed by JetBrains. The following steps are required to enable this feature. This is a one-time setup.

Add the following Maven repository in your `settings.gradle[.kts]` file:
```kotlin
dependencyResolutionManagement {
    repositories {
        maven("https://packages.jetbrains.team/maven/p/kt/dev")
        // existing repositories 
    }
}

pluginManagement {
    repositories {
        maven("https://packages.jetbrains.team/maven/p/kt/dev")
        // existing repositories 
    }
}
```

Then, make sure to use the following Kotlin version: `2.2.21-titan-208`.

If you are using the Kotlin Multiplatform plugin for Android Studio or IntelliJ, specify the following in your `build.gradle[.kts]` file:
```kotlin
kotlin {
  swiftPMDependencies {
    xcodeProjectPathForKmpIJPlugin.set(
      // Specify path to the xcodeproj with :embedAndSignAppleFrameworkForXcode integration:
      layout.projectDirectory.file("../iosApp/iosApp.xcodeproj")
    )
  }
}
```

Now, try to build your iOS project. If you're using [direct integration](https://kotlinlang.org/docs/multiplatform/multiplatform-direct-integration.html) (`embedAndSignAppleFrameworkForXcode`), the build probably fails. However, it will print a Gradle command (`integrateLinkagePackage` with prefilled arguments) for you to run. Run that command to generate the linkage package. This will create a local Swift package named `_internal_linkage_SwiftPMImport`. This package should be version controlled. If you now build your iOS project again, it should succeed.

## Reporting undocumented issues:
Feel free to file an issue! [New RevenueCat Issue](https://github.com/RevenueCat/purchases-kmp/issues/new/). Make sure to state clearly that you're using version 3.0.0. Thanks!
